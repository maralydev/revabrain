// Prisma Schema voor RevaBrain
// Neurologische revalidatiepraktijk - Agenda systeem

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// ============================================
// PATIENT
// ============================================
model Patient {
  id                  Int       @id @default(autoincrement())
  rijksregisternummer String    @unique
  voornaam            String
  achternaam          String
  geboortedatum       DateTime
  telefoonnummer      String
  email               String?

  // Adres
  straat              String?
  huisnummer          String?
  postcode            String?
  gemeente            String?

  // Contactpersoon (voor kinderen/wilsonbekwamen)
  contactpersoon          String?
  contactpersoonTelefoon  String?

  // Metadata
  aangemaakt          DateTime  @default(now())
  laatstGewijzigd     DateTime  @updatedAt

  // Relaties
  afspraken           Afspraak[]
  herhalendeReeksen   HerhalendeReeks[]
}

// ============================================
// TEAMLID (Zorgverlener + Medisch Secretariaat)
// ============================================
model Teamlid {
  id            Int       @id @default(autoincrement())
  voornaam      String
  achternaam    String
  email         String    @unique
  wachtwoord    String    // Gehashed

  // Rol & Rechten
  // Valid values: ZORGVERLENER, SECRETARIAAT
  rol           String    @default("ZORGVERLENER")
  // Valid values: LOGOPEDIE, KINESITHERAPIE, ERGOTHERAPIE, NEUROPSYCHOLOGIE, DIETIEK
  discipline    String?   // Alleen voor zorgverleners
  isAdmin       Boolean   @default(false)
  actief        Boolean   @default(true)
  mustChangePassword Boolean @default(false)  // Force password change on next login

  // Profiel
  foto          String?
  bio           String?

  // Metadata
  aangemaakt    DateTime  @default(now())
  laatstGewijzigd DateTime @updatedAt

  // Relaties
  afspraken           Afspraak[]    @relation("ZorgverlenerAfspraken")
  ingeboekteAfspraken Afspraak[]    @relation("IngeboektDoor")
  herhalendeReeksen   HerhalendeReeks[]
  afwezigheden        Afwezigheid[]
}

// ============================================
// AFSPRAAK
// ============================================
model Afspraak {
  id              Int       @id @default(autoincrement())

  // Wanneer
  datum           DateTime
  duur            Int       // Minuten: 30, 45, 60, 90

  // Type & Reden
  // Valid values: INTAKE, CONSULTATIE, HUISBEZOEK, ADMIN
  type            String
  // Valid values: ARTICULATIE, AFASIE, STOTTEREN, DYSFAGIE, PRELOGOPEDIE, TAALSTOORNIS, DYSARTHRIE, APRAXIE, OVERIG
  roc             String?   // Reden tot Contact (niet voor ADMIN)
  adminTitel      String?   // Titel voor admin-blokken (bv. "Teamvergadering")

  // Status
  // Valid values: TE_BEVESTIGEN, BEVESTIGD, IN_WACHTZAAL, BINNEN, AFGEWERKT, NO_SHOW, GEANNULEERD
  status          String    @default("TE_BEVESTIGEN")

  // Locatie (voor huisbezoek)
  locatieStraat       String?
  locatieHuisnummer   String?
  locatiePostcode     String?
  locatieGemeente     String?
  reistijdMinuten     Int?      // Extra tijd voor reizen

  // Extra info
  notities        String?
  isAlert         Boolean   @default(false)  // Alert voor belangrijke notities

  // Metadata
  aangemaakt      DateTime  @default(now())
  laatstGewijzigd DateTime  @updatedAt

  // Relaties
  patient         Patient?  @relation(fields: [patientId], references: [id])
  patientId       Int?      // Optioneel voor ADMIN blokken

  zorgverlener    Teamlid   @relation("ZorgverlenerAfspraken", fields: [zorgverlenerId], references: [id])
  zorgverlenerId  Int

  ingeboektDoor   Teamlid   @relation("IngeboektDoor", fields: [ingeboektDoorId], references: [id])
  ingeboektDoorId Int

  // Herhalende afspraak (optioneel)
  herhalendeReeks   HerhalendeReeks? @relation(fields: [herhalendeReeksId], references: [id])
  herhalendeReeksId Int?
}

// ============================================
// HERHALENDE REEKS
// Voor patiÃ«nten met vaste wekelijkse sessies
// ============================================
model HerhalendeReeks {
  id              Int       @id @default(autoincrement())

  // Planning
  totaalSessies   Int       // Bv. 12 sessies
  // Valid values: WEKELIJKS, TWEEMAAL_PER_WEEK, MAANDELIJKS, HANDMATIG
  frequentie      String

  // Metadata
  aangemaakt      DateTime  @default(now())

  // Relaties
  patient         Patient   @relation(fields: [patientId], references: [id])
  patientId       Int

  zorgverlener    Teamlid   @relation(fields: [zorgverlenerId], references: [id])
  zorgverlenerId  Int

  afspraken       Afspraak[]
}

// ============================================
// AFWEZIGHEID
// Voor afwezigheidsperiodes (vakantie, ziekte, etc.)
// ============================================
model Afwezigheid {
  id              Int       @id @default(autoincrement())

  // Periode
  startDatum      DateTime
  eindDatum       DateTime

  // Type & Reden
  // Valid values: VAKANTIE, ZIEKTE, OPLEIDING, ANDERE
  type            String
  reden           String?   // Voor type 'ANDERE'

  // Metadata
  aangemaakt      DateTime  @default(now())
  laatstGewijzigd DateTime  @updatedAt

  // Relatie
  zorgverlener    Teamlid   @relation(fields: [zorgverlenerId], references: [id])
  zorgverlenerId  Int
}

// ============================================
// AFSPRAAK TYPE CONFIG
// Voor configureerbare afspraaktypes (admin-only)
// ============================================
model AfspraakTypeConfig {
  id              Int       @id @default(autoincrement())

  // Identificatie
  code            String    @unique  // Matches AfspraakType enum value
  naam            String

  // Display & Gedrag
  kleur           String    // Hex color code
  standaardDuur   Int       // Minuten
  factureerbaar   Boolean   @default(true)
  actief          Boolean   @default(true)

  // Metadata
  aangemaakt      DateTime  @default(now())
  laatstGewijzigd DateTime  @updatedAt
}

// ============================================
// DISCIPLINE CONFIG
// Voor configureerbare disciplines (admin-only)
// ============================================
model DisciplineConfig {
  id              Int       @id @default(autoincrement())

  // Identificatie
  code            String    @unique  // Matches Discipline enum value
  naam            String
  beschrijving    String?   // Description for public website

  // Display
  actief          Boolean   @default(true)
  volgorde        Int       @default(0)  // Display order

  // Metadata
  aangemaakt      DateTime  @default(now())
  laatstGewijzigd DateTime  @updatedAt
}

// ============================================
// AUDIT LOG
// Voor compliance en traceerbaarheid (admin-only viewing)
// ============================================
model AuditLog {
  id              Int       @id @default(autoincrement())

  // Wanneer & Wie
  timestamp       DateTime  @default(now())
  teamlidId       Int
  teamlidNaam     String    // Denormalized for reporting

  // Wat
  actieType       String    // LOGIN, PATIENT_CREATE, PATIENT_DELETE, etc.
  entiteitType    String?   // Patient, Afspraak, Teamlid, etc.
  entiteitId      Int?
  omschrijving    String
  metadata        String?   // JSON string for additional context

  @@index([timestamp(sort: Desc)])
  @@index([teamlidId])
  @@index([actieType])
}

// ============================================
// CONTACT INFO
// Singleton voor website contactgegevens
// ============================================
model ContactInfo {
  id              Int       @id @default(1)

  // Contact
  telefoon        String
  email           String

  // Adres
  adresStraat     String
  adresNummer     String
  adresPostcode   String
  adresGemeente   String

  // Kaart
  latitude        Float?
  longitude       Float?

  // Openingstijden (JSON string)
  openingstijden  String

  // Metadata
  aangemaakt      DateTime  @default(now())
  laatstGewijzigd DateTime  @updatedAt
}
